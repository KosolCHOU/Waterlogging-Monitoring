{% extends "base.html" %}
{% block title %}Sign in ‚Äì CropXcel{% endblock %}

{% block head %}
<style>
  /* Page shell ‚Äì same vibe as your logout page */
  .login-wrap {
    position:fixed;
    inset:0;               /* top:0; right:0; bottom:0; left:0 */
    display:flex;
    justify-content:center;
    align-items:center;
    overflow:hidden;
  }


  /* Card */
  .auth-card{
    width:min(560px, 92vw);
    background:#fff;
    border-radius:20px;
    box-shadow:0 20px 50px rgba(0,0,0,.10);
    padding:28px 24px;
    position:relative; overflow:hidden;
  }
  .ribbon{position:absolute; inset:auto -20% auto -20%; top:-140px; height:220px;
    background:linear-gradient(90deg,#22c55e 0%,#16a34a 50%,#0ea5e9 100%);
    filter:blur(40px); opacity:.12; transform:rotate(-6deg); pointer-events:none}

  /* Icon */
  .sprout{width:64px;height:64px;margin:8px auto 12px; display:block; animation:float 3.8s ease-in-out infinite}
  @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}

  /* Headings */
  .title{font-weight:800; font-size:1.6rem; letter-spacing:.2px; color:#0f172a; margin:6px 0 4px; text-align:center}
  .subtitle{color:#334155; margin:0 0 16px; line-height:1.45; text-align:center}

  /* Alerts */
  .error{background:#fef2f2;border:1px solid #fecaca;color:#991b1b;padding:10px 12px;border-radius:10px;margin-bottom:12px}
  .field-error{color:#b91c1c;font-size:.9rem;margin-top:6px}

  /* Fields */
  .form-grid{display:grid; gap:12px; margin-top:6px}
  .field{position:relative}
  .field label{font-weight:700; color:#0f172a; display:block; margin-bottom:6px}
  .input-wrap{position:relative}
  .input-wrap .ico{
    position:absolute; left:12px; top:50%; transform:translateY(-50%); pointer-events:none; opacity:.7
  }
  .auth-card input[type="text"],
  .auth-card input[type="password"]{
    width:100%; padding:12px 14px 12px 42px;
    border:1px solid #d1d5db; border-radius:12px;
    background:linear-gradient(180deg,#ffffff 0%,#f9fbff 100%);
    color:#0f172a; outline:none;
    transition: box-shadow .2s ease, border-color .2s ease, background .2s ease;
    box-shadow:0 2px 0 rgba(2,132,199,.05) inset;
  }
  .auth-card input:focus{border-color:#0ea5e9; box-shadow:0 0 0 4px rgba(14,165,233,.15)}
  .hint{font-size:.9rem; color:#64748b; margin-top:6px}

  /* CTA Row */
  .cta{margin-top:14px; display:flex; gap:10px; align-items:center}
  .btn{
    appearance:none; border:0; outline:0; cursor:pointer;
    display:inline-flex; align-items:center; justify-content:center;
    gap:8px; padding:12px 16px; border-radius:12px; font-weight:800;
    text-decoration:none; transition:transform .05s ease, box-shadow .2s ease, background .2s ease, color .2s ease;
  }
  .btn:active{transform:translateY(1px)}
  .btn-primary{flex:1; color:#fff; background:linear-gradient(180deg,#0ea5e9,#0284c7); box-shadow:0 8px 20px rgba(2,132,199,.35)}
  .btn-primary:hover{box-shadow:0 10px 26px rgba(2,132,199,.45)}
  .btn-quiet{padding:10px 12px; background:#f1f5f9; color:#0f172a; text-decoration:none; border-radius:10px}
  .btn-quiet:hover{background:#e2e8f0}

  /* Extra helpers */
  .row-between{display:flex; justify-content:space-between; align-items:center; gap:8px}
  .toggle-eye{position:absolute; right:10px; top:50%; transform:translateY(-50%); background:none; border:0; cursor:pointer; font-size:.95rem}

  .help{margin-top:12px; font-size:.95rem; color:#475569; text-align:center}
  .help a{color:#0284c7; text-decoration:none; font-weight:700}
  .help a:hover{text-decoration:underline}
  .small{margin-top:10px; font-size:.82rem; color:#64748b; text-align:center}

  /* Dark mode */
  @media (prefers-color-scheme: dark){
    .login-wrap{background:linear-gradient(180deg, #0b1220 0%, #0b1020 100%)}
    .auth-card{background:#0f172a; box-shadow:0 20px 50px rgba(0,0,0,.5)}
    .title{color:#e2e8f0} .subtitle{color:#cbd5e1}
    .auth-card input{background:linear-gradient(180deg,#0c1323 0%, #0b1220 100%); border-color:#1f2937; color:#e2e8f0}
    .btn-quiet{background:#0b1220; color:#e2e8f0} .btn-quiet:hover{background:#111827}
    .help{color:#cbd5e1} .small{color:#94a3b8}
    .field label{color:#e2e8f0}
  }

  /* Make the button full width like the inputs */
  .cta {
    margin-top: 14px;
    display: block;   /* instead of flex */
  }

  .cta .btn-primary {
    display: block;
    width: 100%;
    text-align: center;
  }

  .auth-card input,
  .cta .btn-primary {
    border-radius: 12px;
  }

</style>
{% endblock %}

{% block content %}
<div class="login-wrap">
  <form method="post" class="auth-card" novalidate>
    <div class="ribbon" aria-hidden="true"></div>

    <!-- Friendly agri icon -->
    <svg class="sprout" viewBox="0 0 64 64" fill="none" aria-hidden="true">
      <path d="M33 46v-9" stroke="#16a34a" stroke-width="3" stroke-linecap="round"/>
      <path d="M33 37c0-8 5-15 15-16 0 9-7 16-15 16Z" fill="#22c55e" opacity=".95"/>
      <path d="M31 39c-7 0-13-6-14-13 7 1 13 7 14 13Z" fill="#86efac" opacity=".95"/>
      <circle cx="32" cy="46" r="3" fill="#0ea5e9" />
      <path d="M10 52c7-5 15-5 22 0 7-5 15-5 22 0" stroke="#94a3b8" stroke-width="2" opacity=".5" stroke-linecap="round"/>
    </svg>

    <h1 class="title">Welcome back</h1>
    <p class="subtitle">Sign in to see your saved fields, alerts, and water-risk analytics.</p>

    {% csrf_token %}
    {% if form.non_field_errors %}
      <div class="error" role="alert">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="form-grid">
      <!-- Username -->
      <div class="field">
        <label for="{{ form.username.id_for_label }}">Username</label>
        <div class="input-wrap">
          <!-- person icon -->
          <svg class="ico" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z" fill="currentColor"/></svg>
          {{ form.username }}
        </div>
        {% if form.username.errors %}
          <div class="field-error">üå± Username is required ‚Äî it‚Äôs how we connect you to your fields.</div>
        {% else %}
          <div class="hint">Use the username you registered with CropXcel.</div>
        {% endif %}
      </div>

      <!-- Password -->
      <div class="field">
        <div class="row-between">
          <label for="{{ form.password.id_for_label }}">Password</label>
          <a class="btn-quiet" href="{% url 'password_reset' %}" style="font-weight:700">Forgot?</a>
        </div>
        <div class="input-wrap">
          <!-- lock icon -->
          <svg class="ico" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M17 9h-1V7a4 4 0 1 0-8 0v2H7a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2Zm-6 6.732V17h2v-1.268a2 2 0 1 0-2 0ZM9 7a3 3 0 1 1 6 0v2H9Z" fill="currentColor"/></svg>
          {{ form.password }}
          <button type="button" class="toggle-eye" aria-label="Show password" title="Show/Hide">üëÅÔ∏è</button>
        </div>
        <div class="hint" id="capsWarn" style="display:none;">Caps Lock is ON ‚Äî passwords are case-sensitive.</div>
        {% if form.password.errors %}
          <div class="field-error">üîí Password is required ‚Äî it keeps your farm data safe.</div>
        {% endif %}
      </div>
    </div>

    {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

    <div class="cta">
      <button class="btn btn-primary" type="submit" aria-label="Sign in to your account">üîê Sign in</button>
    </div>

    <div class="help">New to CropXcel? <a href="{% url 'signup' %}">Create an account</a> (it‚Äôs free).</div>
    <div class="small">Security tip: never share your password. Use strong, unique credentials.</div>
  </form>
</div>

<script>
  // make the fields feel friendlier without touching the form class in Python
  (function () {
    const u = document.getElementById('{{ form.username.id_for_label }}');
    const p = document.getElementById('{{ form.password.id_for_label }}');
    if (u){ u.setAttribute('placeholder','Your username'); u.setAttribute('autocomplete','username'); u.setAttribute('inputmode','text'); u.setAttribute('autofocus','autofocus'); }
    if (p){ p.setAttribute('placeholder','Your password'); p.setAttribute('autocomplete','current-password'); }

    // Show / hide password
    const eye = document.querySelector('.toggle-eye');
    if (eye && p){
      eye.addEventListener('click', () => {
        const isPwd = p.getAttribute('type') === 'password';
        p.setAttribute('type', isPwd ? 'text':'password');
        eye.textContent = isPwd ? 'üôà' : 'üëÅÔ∏è';
      });
    }

    // Caps-Lock warning
    const warn = document.getElementById('capsWarn');
    if (p && warn){
      p.addEventListener('keyup', (e) => {
        if ('getModifierState' in e) {
          warn.style.display = e.getModifierState('CapsLock') ? 'block' : 'none';
        }
      });
      p.addEventListener('focusout',()=> warn.style.display='none');
    }
  })();
</script>
{% endblock %}
